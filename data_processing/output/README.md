# SF Parking Citation Processing - Output Files

This folder contains **logs**, **databases**, and **reports** generated by the production system.

## üìÅ Folder Structure

### `logs/`
Processing and error logs:
- **`citation_processing.log`** - Main citation processor logs
- **`citation_schedule_matching.log`** - Matching analysis logs

### `databases/`  
SQLite databases for progress tracking:
- **`citation_processing_progress.db`** - Resume capability database
  - Tracks processed citations for resumption
  - Prevents duplicate processing
  - Used by `production_citation_processor.py`

### Root Level Files
Analysis reports and outputs:
- **`processing_report_*.json`** - Citation processing performance reports
- **`cleaning_report_simple.txt`** - Schedule data cleaning report

## üìä Log File Contents

### Citation Processing Logs
```
2025-07-21 11:28:26,123 - INFO - üöó Starting Production Citation GPS Processing
2025-07-21 11:28:26,123 - INFO - Fetching citations from last 30 days...
2025-07-21 11:28:26,456 - INFO - Fetched 150 citations (total: 150)
2025-07-21 11:28:26,456 - INFO - Processing 150 citations in batches of 10
2025-07-21 11:28:52,789 - INFO - Processed 10 citations. Success rate: 90.0% (H:9, M:0, F:1)
```

### Schedule Matching Logs  
```
2025-07-21 11:32:53,701 - INFO - üîç Starting Citation-Schedule Matching Analysis (STRICT TIMING)
2025-07-21 11:32:53,776 - INFO - Processing citation-schedule matches with strict timing...
2025-07-21 11:32:57,498 - INFO - Found 65 citation-schedule matches
2025-07-21 11:32:57,508 - INFO - Generated estimates for 3 schedules
```

## üìà Database Schema

### Citation Processing Progress Database
```sql
-- Tracks individual processed citations
processed_citations (
    citation_id TEXT PRIMARY KEY,
    address TEXT,
    datetime TEXT,
    latitude REAL,
    longitude REAL,
    confidence TEXT,
    confidence_score INTEGER,
    geocoding_status TEXT,
    processed_timestamp TEXT
)

-- Tracks processing sessions  
processing_session (
    session_id INTEGER PRIMARY KEY,
    start_time TEXT,
    end_time TEXT,
    total_citations INTEGER,
    processed_count INTEGER,
    success_rate REAL,
    parameters TEXT
)
```

## üìã Report Contents

### Processing Report JSON Structure
```json
{
  "processing_summary": {
    "total_processed": 22,
    "high_confidence": 22,
    "medium_confidence": 0,
    "low_confidence": 0,
    "success_rate": "100.0%",
    "usable_results": 22
  },
  "configuration": {
    "max_workers": 2,
    "batch_size": 10,
    "rate_limit_delay": 0.3,
    "max_retries": 3,
    "timeout": 10,
    "min_confidence": "MEDIUM"
  },
  "timing": {
    "start_time": "2025-07-21T11:28:26.123456",
    "end_time": "2025-07-21T11:29:02.789012",
    "processing_time": "0:00:36.665556",
    "citations_per_minute": 36.0
  }
}
```

### Cleaning Report Structure
```
STREET SWEEPING SCHEDULE DATA CLEANING REPORT - SIMPLE METHOD
Generated: 2025-07-21 11:28:46

ORIGINAL DATA:
- Total records: 37,878
- Unique BlockSweepIDs: 37,878

CLEANED DATA (SIMPLE METHOD):  
- Total records: 22,909
- Reduction: 14,969 records (39.5%)
- New CleanBlockSweepIDs: 22,909

CLEANING ACTIONS:
- Records requiring combination: 5,877
- Records kept as-is: 17,032
- Missing coordinates flagged: 17
```

## üîç Monitoring & Debugging

### Check Processing Health
```bash
# View recent citation processing logs
tail -f logs/citation_processing.log

# Check for errors in matching
grep ERROR logs/citation_schedule_matching.log

# View processing statistics
cat processing_report_*.json | python3 -m json.tool
```

### Database Queries
```sql
-- Check processed citation count
SELECT COUNT(*) FROM processed_citations;

-- View confidence distribution
SELECT confidence, COUNT(*) FROM processed_citations GROUP BY confidence;

-- Find failed processing attempts
SELECT * FROM processed_citations WHERE geocoding_status LIKE 'ERROR%';
```

### Resume Processing
The SQLite database enables resume capability:
- **Automatic**: Production scripts check for existing processed citations
- **Manual**: Delete specific records from database to reprocess them
- **Fresh Start**: Use `--no-resume` flag or delete the database file

## üßπ Maintenance

### Log Rotation
Logs can grow large during processing. Consider rotating them:
```bash
# Archive old logs
mv logs/citation_processing.log logs/citation_processing_$(date +%Y%m%d).log

# Clean up old archives (keep last 30 days)
find logs/ -name "*.log" -mtime +30 -delete
```

### Database Cleanup
```sql
-- Remove old processed citations (if reprocessing needed)
DELETE FROM processed_citations WHERE processed_timestamp < '2025-07-01';

-- Vacuum database to reclaim space
VACUUM;
```

## üìä Performance Metrics

Based on current output files:
- **Processing Rate**: 36 citations/minute with 2 workers
- **Success Rate**: 100% for HIGH confidence in test data
- **Storage**: ~100KB per 1000 processed citations in database
- **Log Growth**: ~10MB per 10,000 citations processed